# XSCTF联合招新赛 CRYPTO方向 最后的谜题

by zijeff

首先看题目文件，文件名提到了凯撒密码，历史上的凯撒密码是一种单表替换密码。

仔细阅读题目中的加密算法后发现，题目也是一种替换加密，替换加密的关键在于理解明文是如何替换为密文的。

```python
for mt in m:
        tmp = key.find(mt) 
        k = kt
        for _ in range(len(m)):
            tmp = tmp * a if k % 2 == 0 else tmp + b
            k = k // 2
        c += key[tmp % len(key)]
```

对明文中的每个字符加密是第二部分，即对k做奇偶判断，偶数就乘上a，奇数就加上b。但如果我们跳出具体的每一步，我们会发现实际上的加密用一个式子就可以概括。
$$
y=kx+r \mod n
$$
其中y是加密后的密文字母，x是明文字母，n是key的长度。因为我们发现循环里就是在做乘法和加法，那最后我一定可以表示成上面的式子。而循环的次数又是由kt所决定，恰好kt在进入循环前已经确定，也就是说对于明文中所有字母的替换加密中的k和r都是相同的。

题目中只删除了前四个字母，所以我们由观察可知“Wh”是由“f{”加密得到的，借此可以构建两个方程解出k和r。

再根据解出的k和r，对所有的密文解密。具体数学推导如下：

因为我们知道两个字母之间的映射关系，所以列式如下：
$$
y_1=kx_1+r \mod n
$$

$$
y_2=kx_2+r \mod n
$$

相减得：
$$
y_1-y_2=k(x_1-x_2) \mod n
$$
然后求解一下乘法逆元，就可以求出k了，最后代入求得r。

最后答案是：***hsctf{th3_l4st_s3c5et_0f_4he_un1ve2se_1s_42}***

